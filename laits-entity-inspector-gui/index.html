<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entity Inspector</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="scanlines"></div>
    <div class="noise"></div>

    <div class="container">
        <!-- Header -->
        <header class="header" id="header">
            <div class="header-logo-section" id="header-logo-section">
                <span class="header-toggle" id="header-toggle">&#9660;</span>
                <pre class="logo" id="logo">
╔═════════════════════════════════════════════════════════════════════╗
║  ███████╗███╗   ██╗████████╗██╗████████╗██╗   ██╗                   ║
║  ██╔════╝████╗  ██║╚══██╔══╝██║╚══██╔══╝╚██╗ ██╔╝                   ║
║  █████╗  ██╔██╗ ██║   ██║   ██║   ██║    ╚████╔╝                    ║
║  ██╔══╝  ██║╚██╗██║   ██║   ██║   ██║     ╚██╔╝                     ║
║  ███████╗██║ ╚████║   ██║   ██║   ██║      ██║                      ║
║  ╚══════╝╚═╝  ╚═══╝   ╚═╝   ╚═╝   ╚═╝      ╚═╝   I N S P E C T O R  ║
╚═════════════════════════════════════════════════════════════════════╝</pre>
                <span class="header-collapsed-title" id="header-collapsed-title">ENTITY INSPECTOR</span>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <span class="label">STATUS:</span>
                    <span id="connection-status" class="status disconnected">● DISCONNECTED</span>
                </div>
                <div class="status-item">
                    <span class="label">ENTITIES:</span>
                    <span id="entity-count" class="value">0</span>
                </div>
                <div class="status-item">
                    <span class="label">WORLD:</span>
                    <span id="world-name" class="value">---</span>
                </div>
                <div class="status-item">
                    <span class="label">UPTIME:</span>
                    <span id="uptime" class="value">00:00:00</span>
                </div>
            </div>
        </header>

        <!-- Tab Bar -->
        <div class="tab-bar">
            <button class="tab-btn active" data-tab="entities">[E] ENTITIES</button>
            <button class="tab-btn" data-tab="assets">[A] ASSETS</button>
        </div>

        <!-- Global Changes Header -->
        <div id="changed-components-header" class="changed-components-header hidden">
            <div class="header-label">LIVE CHANGES</div>
            <div class="component-chips-container">
                <div class="component-chips" id="component-chips"></div>
            </div>
        </div>

        <!-- Tab Content: Entities -->
        <div class="tab-content active" id="tab-entities">
        <!-- Main Content -->
        <main class="main">
            <!-- Entity List Panel -->
            <section class="panel entity-list-panel" id="entity-list-panel">
                <div class="panel-header">
                    <span class="panel-title">┌─[ ENTITY LIST ]─────────────────────────┐</span>
                </div>
                <div class="search-box">
                    <span class="prompt">&gt;</span>
                    <input type="text" id="search-input" placeholder="FILTER: type or model..." autocomplete="off">
                    <span class="cursor">█</span>
                </div>
                <div class="entity-list-header">
                    <span class="col-id">ID</span>
                    <span class="col-type">TYPE</span>
                    <span class="col-model">MODEL</span>
                    <span class="col-pos">POSITION</span>
                </div>
                <div id="entity-list" class="entity-list">
                    <div class="empty-state">
                        <pre>
    ░░░░░░░░░░░░░░░░░░░░░
    ░  NO ENTITIES YET  ░
    ░   WAITING FOR     ░
    ░    CONNECTION     ░
    ░░░░░░░░░░░░░░░░░░░░░
                        </pre>
                    </div>
                </div>
                <div class="panel-footer">└─────────────────────────────────────────┘</div>
            </section>

            <!-- Resize Handle -->
            <div class="resize-handle" id="resize-handle"></div>

            <!-- Inspector Panel -->
            <section class="panel inspector-panel" id="inspector-panel">
                <div class="panel-header">
                    <span class="panel-title">┌─[ COMPONENT INSPECTOR ]─────────────────┐</span>
                    <button class="copy-btn" id="inspector-copy-btn" title="Copy as JSON">&#128203;</button>
                </div>
                <div class="component-filter-box">
                    <span class="prompt">⚙</span>
                    <input type="text" id="component-filter" placeholder="FILTER: interaction, action, npc..." autocomplete="off">
                </div>
                <div id="inspector-content" class="inspector-content">
                    <div class="empty-state">
                        <pre>
    ╔════════════════════╗
    ║  SELECT AN ENTITY  ║
    ║   TO INSPECT ITS   ║
    ║    COMPONENTS      ║
    ╚════════════════════╝
                        </pre>
                    </div>
                </div>
                <div class="panel-footer">└─────────────────────────────────────────┘</div>
            </section>

        </main>
        </div><!-- /tab-entities -->

        <!-- Tab Content: Assets -->
        <div class="tab-content" id="tab-assets">
            <div class="assets-layout">
                <!-- Left: Categories Panel -->
                <section class="panel categories-panel">
                    <div class="panel-header">
                        <span class="panel-title">┌─[ CATEGORIES ]──────────────┐</span>
                    </div>
                    <div class="category-list" id="category-list">
                        <div class="empty-state">
                            <pre>Loading categories...</pre>
                        </div>
                    </div>
                </section>

                <!-- Center: Asset List + Detail -->
                <div class="assets-main">
                    <section class="panel asset-list-panel">
                        <div class="panel-header">
                            <span class="panel-title">┌─[ ASSET LIST ]──────────────┐</span>
                        </div>
                        <div class="search-box">
                            <span class="prompt">/</span>
                            <input type="text" id="asset-filter" placeholder="Filter assets..." autocomplete="off">
                            <button class="search-mode-toggle" id="search-mode-toggle" title="Toggle category/global search">⚙</button>
                        </div>
                        <div class="asset-list" id="asset-list">
                            <div class="empty-state">
                                <pre>Select a category</pre>
                            </div>
                        </div>
                    </section>

                    <section class="panel asset-detail-panel">
                        <div class="panel-header">
                            <span class="panel-title">┌─[ ASSET DETAIL ]────────────┐</span>
                            <button class="patch-btn hidden" id="patch-btn" title="Create Patch">PATCH</button>
                        </div>
                        <div class="asset-detail" id="asset-detail">
                            <div class="empty-state">
                                <pre>Select an asset to view details</pre>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Right: History Sidebar -->
                <aside class="history-sidebar">
                    <div class="sidebar-header">HISTORY</div>
                    <div class="history-list" id="history-list">
                        <div class="empty-state small">
                            <pre>No patches yet</pre>
                        </div>
                    </div>
                </aside>
            </div>
        </div><!-- /tab-assets -->

        <!-- Packet Log Panel (collapsible bottom panel) -->
        <section class="panel packet-log-panel" id="packet-log-panel">
            <div class="packet-log-header" id="packet-log-header">
                <span class="panel-title">
                    <span class="toggle-arrow" id="packet-log-toggle">&#9660;</span>
                    [ PACKET LOG ]
                </span>
                <div class="packet-log-controls">
                    <button class="control-btn" id="packet-fullscreen-btn" title="Toggle Fullscreen (F)">⤢</button>
                    <button class="control-btn" id="packet-pause-btn" title="Pause/Resume">
                        <span id="packet-pause-icon">||</span>
                    </button>
                    <button class="control-btn" id="packet-clear-btn" title="Clear Log">X</button>
                    <input type="text" id="packet-filter-input" placeholder="Filter packets..." autocomplete="off">
                    <select id="packet-direction-filter">
                        <option value="all">All</option>
                        <option value="inbound">Inbound</option>
                        <option value="outbound">Outbound</option>
                    </select>
                    <span class="packet-count" id="packet-count">0 packets</span>
                </div>
            </div>
            <div class="packet-log-body" id="packet-log-body">
                <div class="packet-list" id="packet-list">
                    <div class="empty-state">
                        <pre>Waiting for packets...</pre>
                    </div>
                </div>
                <div class="packet-detail" id="packet-detail">
                    <div class="empty-state">
                        <pre>Click a packet to view details</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-left">
                <span class="made-by">Made by Lait</span>
                <span class="footer-separator">|</span>
                <span class="key">[H]</span> Header
                <span class="key">[P]</span> Packets
                <span class="key">[F]</span> Fullscreen
                <span class="key">[S]</span> Settings
                <span class="key">[R]</span> Reconnect
            </div>
            <div class="footer-center">
                <button class="pause-btn" id="inspector-pause-btn" title="Pause/Resume Updates (Space)">
                    <span id="inspector-pause-icon">||</span>
                    <span id="inspector-pause-label">PAUSE</span>
                </button>
            </div>
            <div class="footer-right">
                <button class="settings-toggle-btn" id="settings-toggle-btn" title="Settings">&#9881;</button>
                <div class="theme-selector">
                    <label for="theme-select">Theme:</label>
                    <select id="theme-select">
                        <option value="terminal">Terminal</option>
                        <option value="standard">Standard</option>
                        <option value="light">Light</option>
                    </select>
                </div>
                <span id="last-update">Last update: ---</span>
            </div>
        </footer>
    </div>

    <!-- Event Log (hidden by default, toggle with L) -->
    <div id="event-log" class="event-log hidden">
        <div class="log-header">┌─[ EVENT LOG ]─┐</div>
        <div id="log-content" class="log-content"></div>
    </div>

    <!-- Patch Editor Modal -->
    <div id="patch-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-panel patch-modal-panel">
            <div class="modal-header">
                <span class="modal-title">┌─[ CREATE PATCH ]────────────────────────┐</span>
                <div class="mode-toggle">
                    <button class="mode-btn active" data-mode="diff">Diff</button>
                    <button class="mode-btn" data-mode="json">JSON</button>
                </div>
                <button class="modal-close" id="patch-modal-close">&times;</button>
            </div>

            <div class="modal-body">
                <!-- Patch Configuration -->
                <div class="patch-config">
                    <div class="config-row">
                        <label>BaseAssetPath:</label>
                        <input type="text" id="patch-base-path" placeholder="NPC/Roles/Cow.json">
                        <button class="test-btn" id="test-wildcard-btn" title="Test Wildcard">Test</button>
                    </div>
                    <div class="config-row" id="wildcard-matches-row" style="display:none;">
                        <label>Matches:</label>
                        <select id="wildcard-matches"></select>
                    </div>
                    <div class="config-row">
                        <label>Operation:</label>
                        <select id="patch-operation">
                            <option value="merge">merge (default)</option>
                            <option value="replace">replace</option>
                            <option value="add">add</option>
                            <option value="remove">remove</option>
                            <option value="upsert">upsert</option>
                        </select>
                    </div>
                </div>

                <!-- Diff Mode Editor -->
                <div class="patch-editor diff-mode" id="patch-editor-diff">
                    <div class="editor-pane original-pane">
                        <div class="pane-header">ORIGINAL (read-only)</div>
                        <pre id="original-json" class="json-view"></pre>
                    </div>
                    <div class="editor-pane modified-pane">
                        <div class="pane-header">MODIFIED</div>
                        <textarea id="modified-json" class="json-edit" spellcheck="false"></textarea>
                    </div>
                </div>

                <!-- JSON Mode Editor -->
                <div class="patch-editor json-mode hidden" id="patch-editor-json">
                    <div class="editor-pane full-width">
                        <div class="pane-header">PATCH JSON</div>
                        <textarea id="direct-json" class="json-edit" spellcheck="false" placeholder='{"BaseAssetPath": "...", "Health": 150}'></textarea>
                    </div>
                </div>

                <!-- Generated Patch Preview -->
                <div class="patch-preview">
                    <div class="pane-header">GENERATED PATCH</div>
                    <pre id="patch-preview" class="json-view"></pre>
                </div>
            </div>

            <div class="modal-footer">
                <div class="filename-row">
                    <label>Filename:</label>
                    <input type="text" id="patch-filename" placeholder="MyPatch.json">
                </div>
                <div class="draft-status" id="draft-status"></div>
                <div class="modal-actions">
                    <button class="modal-btn secondary" id="save-draft-btn">Save Draft</button>
                    <button class="modal-btn primary" id="publish-btn">Publish</button>
                    <button class="modal-btn" id="cancel-patch-btn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="settings-modal hidden">
        <div class="settings-overlay"></div>
        <div class="settings-panel">
            <div class="settings-header">
                <span class="settings-title">┌─[ SETTINGS ]────────────────────────────┐</span>
                <button class="settings-close" id="settings-close">&times;</button>
            </div>
            <div class="settings-content">
                <!-- General Settings -->
                <div class="settings-section">
                    <h3>General</h3>
                    <div class="setting-row">
                        <label for="setting-enabled">Inspector Enabled</label>
                        <input type="checkbox" id="setting-enabled" checked>
                    </div>
                    <div class="setting-row">
                        <label for="setting-update-interval">Update Interval (ticks)</label>
                        <input type="number" id="setting-update-interval" min="1" max="100" value="3">
                    </div>
                    <div class="setting-row">
                        <label for="setting-max-cached">Max Cached Entities</label>
                        <input type="number" id="setting-max-cached" min="100" max="50000" value="5000">
                    </div>
                    <div class="setting-row">
                        <label for="setting-pause-on-expand">Auto-pause on Expand</label>
                        <input type="checkbox" id="setting-pause-on-expand" checked>
                        <span class="setting-hint">Automatically pause when expanding fields</span>
                    </div>
                </div>

                <!-- Entity Filters -->
                <div class="settings-section">
                    <h3>Entity Filters</h3>
                    <div class="setting-row">
                        <label for="setting-include-npcs">Include NPCs</label>
                        <input type="checkbox" id="setting-include-npcs" checked>
                    </div>
                    <div class="setting-row">
                        <label for="setting-include-players">Include Players</label>
                        <input type="checkbox" id="setting-include-players" checked>
                    </div>
                    <div class="setting-row">
                        <label for="setting-include-items">Include Items</label>
                        <input type="checkbox" id="setting-include-items">
                    </div>
                </div>

                <!-- Packet Log Settings -->
                <div class="settings-section">
                    <h3>Packet Log</h3>
                    <div class="setting-row">
                        <label for="setting-packet-enabled">Packet Logging Enabled</label>
                        <input type="checkbox" id="setting-packet-enabled" checked>
                    </div>
                    <div class="setting-row">
                        <label for="setting-packet-excluded">Excluded Packets</label>
                        <input type="text" id="setting-packet-excluded" placeholder="EntityUpdates, CachedPacket">
                        <span class="setting-hint">Comma-separated packet names</span>
                    </div>
                </div>

                <!-- WebSocket Settings (read-only info) -->
                <div class="settings-section">
                    <h3>WebSocket (Read Only)</h3>
                    <div class="setting-row">
                        <label>Port</label>
                        <span id="setting-ws-port" class="setting-value">8765</span>
                    </div>
                    <div class="setting-row">
                        <label>Bind Address</label>
                        <span id="setting-ws-address" class="setting-value">127.0.0.1</span>
                    </div>
                    <div class="setting-row">
                        <label>Max Clients</label>
                        <span id="setting-ws-max-clients" class="setting-value">10</span>
                    </div>
                </div>
            </div>
            <div class="settings-footer">
                <button class="settings-btn" id="settings-apply">Apply Changes</button>
                <button class="settings-btn secondary" id="settings-cancel">Cancel</button>
                <span class="settings-status" id="settings-status"></span>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
